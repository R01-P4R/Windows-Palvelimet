# 2. Virtuaalikoneiden malli ja palvelinkoneiden alustus


## Teht√§v√§nanto

1. Luodaan uusi virtuaalikone
2. Asennetaan Windows-k√§ytt√∂j√§rjestelm√§ luotuun virtuaalikoneeseen
3. Luodun virtuaalikoneen mallinnus
4. Mallikoneen k√§ytt√§minen uusien virtuaalikoneiden pohjana


## Hyper-V ja uuden virtuaalikoneen luominen

Aloitin k√§ynnist√§m√§ll√§ microsoft azure-virtuaaliymp√§rist√∂n ja avaamlla hyper-v ohjelman siirryin luomaan uutta virtuaalikonetta, mik√§ tulee toimimaan my√∂s mallina tuleville virtuaalikoneille ymp√§rist√∂ss√§. Annoin koneelle ohjeiden mukaisesti nimeksi "WindowsServerTemplate". Valitsin virtuaalikoneen generaatioksi "generation 1", sill√§ siin√§ on tarvittavat ominaisuudet kurssia varten.
Muistia virtuaalikoneelle annoin 3072 MB ja laitoin dynaamisen muistin allokoinnin p√§√§lle, mik√§ parantaa muistin kulutusta k√§ytt√§m√§ll√§ sit√§ vain tarpeiden mukaisesti. Verkkoyhteyden adapteriksi valitsin aikaisemmassa harjoituksessa luodun "HyperVVSwitch".

Seuraavaksi loin virtuaalikoneelle uuden kovalevyn ja annoin sen nimeksi "WindowsServerTemplate.vhdx" ja sen muistin m√§√§r√§ksi 30 GB. Seuraaavaksi p√§√§sin valitsemaan miten haluan asentaa virtuaalikoneen k√§ytt√∂j√§rjestelm√§n ja valitsin ISO-tiedoston, joka l√∂ytyi valmiina ty√∂p√∂yd√§lt√§. Lopuksi viel√§ muutin virtuaalikoneen prosessorien m√§√§r√§n nelj√§√§n hyper-v managerin kautta.


<br>
<br>


<img width= "750" height="469" alt="image" src="https://github.com/user-attachments/assets/649cca7d-f549-4d03-abaf-f4aa794ec01f" />

  > Uusi luotu virtuaalikone Hyper-V managerissa.


<br>
<br>


## Windowsin asentaminen virtuaalikoneelle

Aloitin valitsemalla luodon virtuaalikoneen Hyper-V managerissa ja valitsemalla "connect". Yhdistetty√§ koneeseen painoin "start" k√§ynnist√§√§kseni koneen ja muokkasin virtuaalikoneen ikkunan zoomasetusta vastaamaan: "100 %", jotta ty√∂skentely olisi jatkossa helpompaa. Windows asennusohjelman alkuvaiheessa valitsin seuraavat asetukset:

    Language install: English (United States)
    Time and currency format: finnish (Finland)
    Keyboard or input method: Finnish

Seuraavassa ruudussa valitsin "Install now", jonka j√§lkeen piti hyv√§ksy√§ Windowsin lisenssiehdot, mink√§ j√§lkeen valitsin "Custom: Install Windows only (advanced)". K√§ytin asennusohjelman ehdottamaa tallennustilaa, mink√§ j√§lkeen Windows rupesi asentamaan itse√§√§n. Asennuksessa meni noin 11 minuuttia, mink√§ j√§lkeen virtuaalikone k√§ynnistyi uudestaan. Uudelleen k√§ynnistyksen aikana, poistin aikaisemmin k√§ytt√§m√§ni ISO-tiedoston virtuaalikoneen levyasemasta, jotta Windowsin asennusprosessi ei alkaisi uudestaan alkupisteest√§. 

Koneen k√§ynnistetty√§ loin Admin-k√§ytt√§j√§profiilin ja kirjauduin koneen ty√∂p√∂yd√§lle k√§ytt√§en aikaisemmin luomiani tunnuksia ja Windowsin Server Manager-ohjelma avautui ty√∂p√∂yd√§lle. Server Manageria k√§ytet√§√§n hallitsemaan Windows palvelinkoneen toimialuetta.

## Mallinnus: Windows-palvelinkoneen alustus

T√§ss√§ vaiheessa olisi tarkoitus mallintaa aikaisemmin luotua virtuaalikonetta k√§ytett√§v√§ksi pohjana uusille virtuaalikoneille hy√∂dynt√§en sysrep-ty√∂kalua. Aloitin avaamalla aikasemmin luodun WindowsServer-virtuualikoneen CMD-ohjelman adminoikeuksilla ja sy√∂tt√§m√§ll√§ komennon:

      C:\Windows\System32\Sysprep\sysprep.exe /generalize /shutdown
      
Avatakseni sysrep-ohjelman. Valitsin sysrep-ohjelmassa ohjeen mukaan seuraavat vaihtoehdot:

    System Cleanup Action: Enter System Out-of-Box Experience (OOBE)
    Generalize:  üóπ
    Shutdown options: Shutdown

Hyv√§ksytty√§ni asetukset virtuaalikone sammutti itsens√§ ja k√§ynnistetty√§ uudestaan virtuaalikoneelta oli poistettu aikaisemmin tehdyt konfiguraatiot ja sis√§iset tunnistetiedot mik√§ jatkossa mahdollistaa koneen k√§ytt√§mist√§ neutraalina alustana uusien koneiden luontiin.

## Mallikoneen k√§ytt√§minen useamman palvelinkoneen pohjana

Saatuani alustettua WindowsServer-mallikoneen sysrep-ty√∂kalulla siirryin luomaan kahta uutta virtuaalikovalevy√§ k√§ytett√§v√§ksi my√∂hempien virtuaalikoneiden luontia varten. Aloitin varmistamalla, ett√§ WindowsServer-virtuaalikone oli sammutettuna ja sen j√§lkeen Hyper-V managerissa valitsin WindowsServer-koneen ja valitsin "Export". Valitsin kohteeksi virtuaalikoneen ty√∂p√∂yd√§lle luodun HyperV-kansion. Viety√§ni virtuaalikovalevyn valittuun kansioon kopion tarvittavan virtuaalikovalevytiedoston "WindowsServerTemplate.vhdx" polusta:

    C:\Users\Admin123456\Desktop\HyperV\WindowsServerTemplate\Virtual Hard Disks

  Kopioin tiedoston ja loin kaksi uutta virtuaalikovalevytiedosta:

    WindowsServer_DC.vhdx
    WindowsServer_FileServer.vhdx


<br>
<br>

<img width="952" height="315" alt="image" src="https://github.com/user-attachments/assets/595fbc43-a152-47e4-9a3f-b815c7adb75f" />

    >N√§m√§ tiedostot tulevat auttamaan luomaan uusia virtuaalikoneita nopeammin tulevissa harjoituksissa.


